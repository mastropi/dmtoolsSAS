<!DOCTYPE html>

<html>
<head>
<title>%InformationValue</title>
<style>
pre {display: block}
</style>
<body>
<h1>MACRO %InformationValue</h1>
<pre>Version:                      4.01                                                                                      </pre>
<pre>Author:                       Daniel Mastropietro                                                                       </pre>
<pre>Created:                      06-Jul-2005                                                                               </pre>
<pre>Modified:                     10-Jan-2018 (previous: 17-Jun-2017, 17-May-2016, 15-Apr-2016)                                                            </pre>
<pre>                                                                                                                        </pre>
<h3>DESCRIPTION:</h3>
<pre>This macro computes the Information Value (IV) provided by a set of input variables w.r.t.                                                                                          </pre>
<pre>a binary target variable.                                                                                               </pre>
<pre>                                                                                                                        </pre>
<pre>The input variables can be either categorical or continuous. In the continuous case, the                                                                                          </pre>
<pre>input variable is categorized into the specified number of groups.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>Note that ALL numeric variables are considered continuous if the GROUPS= parameter is not empty.                                                                                          </pre>
<pre>If GROUPS= is empty, they are considered categorical.                                                                                          </pre>
<pre>In order to analyze a set of numeric variables that include both categorical and continuous                                                                                          </pre>
<pre>variables, the analysis should be run separately, once on the categorical variables and                                                                                          </pre>
<pre>once for the continuous variables.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>The macro optionally creates an output dataset containing formats that allow reproducing the                                                                                          </pre>
<pre>categorization carried out by the macro on the continuous analysis variables.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>For more details on the calculation of the Information Value see the DETAILS section below.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<h3>USAGE:</h3>
<pre>%InformationValue(                                                                                          </pre>
<pre>          data,                         /* Input dataset. */                                        </pre>
<pre>          target=,                      /* Dichotomous target variable. */                              </pre>
<pre>          var=_ALL_,                    /* Analysis variables (character or numeric). */                              </pre>
<pre>          event=,                       /* Event of interest. */                                    </pre>
<pre>          groups=10,                    /* Nro. of groups to use to categorize numeric variables. Leave it empty if ALL analyzed variables are categorical. */                              </pre>
<pre>          condition=,                   /* Condition that each analysis variable should satisfy in order to be part of the grouping. */                              </pre>
<pre>          stat=,                        /* Statistic to use as representation of each category of numeric variables. */                              </pre>
<pre>          format=,                      /* Formats to use for each analysis variable. */                              </pre>
<pre>          smooth=1,                     /* Whether to smooth the WOE calculation in order to avoid missing values. */                              </pre>
<pre>          out=_InformationValue_,       /* Output dataset containing the Information Value for each variable. */                              </pre>
<pre>          outwoe=_InformationWOE_,      /* Output dataset containing the WOE and IV for each bin of the categorized variables. */                              </pre>
<pre>          outformat=,                   /* Output dataset containing format definitions corresponding to the WOE bins. */                              </pre>
<pre>          notes=1,                      /* Show SAS notes in the log? */                              </pre>
<pre>          log=1);                       /* Show messages in the log? */                              </pre>
<pre>                                                                                                    </pre>
<h3>REQUIRED PARAMETERS:</h3>
<pre>- data:                       Input dataset. Data options can be specified as in a data= SAS option.                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- target:                     Dichotomous target variable. It can be either character or numeric.                                                            </pre>
<pre>                                                                                                                        </pre>
<h3>OPTIONAL PARAMETERS:</h3>
<pre>- var:                        Blank-separated list of variables to analyze.                                                            </pre>
<pre>                              The variables can be either character or numeric, or both.                                                            </pre>
<pre>                              default: all variables in the dataset except for the target variable                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- event:                      The event of interest.                                                                    </pre>
<pre>                              If the target variable is character then:                                                            </pre>
<pre>                              - Its value must be enclosed in quotation marks.                                                            </pre>
<pre>                              - The specification of the event is case sensitive and it must respect                                                            </pre>
<pre>                              the case of the values taken by the target variable.                                                            </pre>
<pre>                              If the value specified does not correspond to any value taken by the target                                                            </pre>
<pre>                              variable, the default is used.                                                            </pre>
<pre>                              default: the largest target value                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- groups:                     Number of groups to use for the categorization of numeric variables listed in VAR=.                                                            </pre>
<pre>                              Equal size groups are used.                                                               </pre>
<pre>                              Leave it empty if no categorization is wished. For instance, for categorical variables.                                                            </pre>
<pre>                              default: 10                                                                               </pre>
<pre>                                                                                                                        </pre>
<pre>- condition:                  Expression specifying a condition that each numeric variable should satisfy in order to                                                            </pre>
<pre>                              be part of the grouping process.                                                            </pre>
<pre>                              Ex:                                                                                       </pre>
<pre>                              condition=~=0, meaning that 0 values are not grouped, but left on their own.                                                            </pre>
<pre>                              condition=%quote(not in (0, 1)), meaning that 0 and 1 values are left on their own.                                                            </pre>
<pre>                              default: empty => all values are considered during the grouping process                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- stat:                       Statistic to show for each category of numeric variables, such as the mean.                                                            </pre>
<pre>                              default: empty => each category is represented by an arbitrary integer value (normally                                                            </pre>
<pre>                              going from 1 to the number of groups, but this depends on how variable values are grouped)                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- format:                     Formats to use for selected analysis variables listed in VAR and/or for the TARGET variable.                                                            </pre>
<pre>                              This statement can be used to define groups.                                                            </pre>
<pre>                              The formats should be specified as in any FORMAT statement.                                                            </pre>
<pre>                              Ex:                                                                                       </pre>
<pre>                              var1 varf.                                                                                </pre>
<pre>                              var2 varg.                                                                                </pre>
<pre>                                                                                                                        </pre>
<pre>- smooth:                     Flag indicating whether to smooth or not the computation of the WOE to avoid                                                            </pre>
<pre>                              missing values of WOE in extreme situations when the same value of the target                                                            </pre>
<pre>                              variable is observed for all cases in a category of the analyzed input variable.                                                            </pre>
<pre>                              The smoothing factor is set to 0.5/                                                            </pre>
<pre>                              Possible values: 0 => do not smooth, 1 => smooth                                                            </pre>
<pre>                              default: 1                                                                                </pre>
<pre>                                                                                                                        </pre>
<pre>- out:                        Output datase containing the Information Value of each variable listed in VAR.                                                            </pre>
<pre>                              Data options can be specified as in a data= SAS option.                                                            </pre>
<pre>                              The dataset has the following columns:                                                            </pre>
<pre>                              - var:                        Variable name.                                              </pre>
<pre>                              - n:                          Number of observations in the dataset with non missing values of the                              </pre>
<pre>                              analysis variable and the target variable.                                                            </pre>
<pre>                              - nvalues:                    Number of distinct values taken by the variable.                              </pre>
<pre>                              - nused:                      Number of distinct values of the variable that were used in the                               </pre>
<pre>                              computation of the Information Value. This is the same as the number                                                            </pre>
<pre>                              of variable values for which the WOE is missing, which corresponds                                                            </pre>
<pre>                              to values for which the information provided is infinite.                                                            </pre>
<pre>                              - IV:                         Information Value of the analysis variable.                              </pre>
<pre>                              - IVAdj:                      Adjusted Information Value based on the number of cases in each bin                              </pre>
<pre>                              and on the number of groups that contribute to the IV.                                                            </pre>
<pre>                              - EntropyRel:                 Entropy of the analyzed variable relative to the maximum possible entropy                              </pre>
<pre>                              (which occurs when all categories of the analyzed variable have the same                                                            </pre>
<pre>                              number of cases).                                                                         </pre>
<pre>                              default: _InformationValue_                                                               </pre>
<pre>                                                                                                                        </pre>
<pre>- outwoe:                     Output dataset containing the distribution of the target variable for each value                                                            </pre>
<pre>                              of the variables listed in VAR.                                                            </pre>
<pre>                              Data options can be specified as in a data= SAS option.                                                            </pre>
<pre>                              The dataset has the following columns:                                                            </pre>
<pre>                              - var:                        Variable name.                                              </pre>
<pre>                              - numvalue(*):                Value taken by the numeric variables in the corresponding bin.                              </pre>
<pre>                              - charvalue(*):               Value taken by the character variables in the corresponding bin.                              </pre>
<pre>                              - n:                          Number of observations in the dataset with non missing values of the                              </pre>
<pre>                              target variable for the corresponding bin.                                                            </pre>
<pre>                              - pcnt:                       Proportion of observations in the dataset with non missing values of                              </pre>
<pre>                              the target variable for the corresponding bin.                                                            </pre>
<pre>                              - nNonEvent:                  Number of Non-Events in the corresponding bin.                              </pre>
<pre>                              - pcntNonEvent:               Proportion of Non-Events in the corresponding bin.                              </pre>
<pre>                              - nEvent:                     Number of Events in the corresponding bin.                              </pre>
<pre>                              - pcntEvent:                  Proportion of Events in the corresponding bin.                              </pre>
<pre>                              - WOE:                        Weight Of Evidence of the analysis variable by the corresponding bin.                              </pre>
<pre>                              - IV:                         Contribution to the Information Value of the analysis variable by the                              </pre>
<pre>                              corresponding bin.                                                                        </pre>
<pre>                              - IVAdj:                      Contribution to the Adjusted Information Value of the analysis variable                              </pre>
<pre>                              by the corresponding bin.                                                                 </pre>
<pre>                              (*) If all the analysis variables are character or all the analysis variables are                                                            </pre>
<pre>                              numeric, there is only one column containing the values taken by the variables whose                                                             </pre>
<pre>                              name is VALUE. In this case, the columns NUMVALUE and CHARVALUE are not present in                                                             </pre>
<pre>                              the output dataset.                                                                       </pre>
<pre>                              default: _InformationWOE_                                                                 </pre>
<pre>                                                                                                                        </pre>
<pre>- ouformat:                   Output dataset containing the formats that could be applied to each input variable                                                            </pre>
<pre>                              in order to reproduce the categorization performed by this macro.                                                            </pre>
<pre>                              IMPORTANT: This dataset is only created when VALUE=MAX, as the format definition                                                            </pre>
<pre>                              is based on knowing the right-end value of each bin.                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>                              This dataset can be used as CNTLIN dataset in the PROC FORMAT statement.                                                            </pre>
<pre>                              The following variables are included in the OUTFORMAT dataset:                                                            </pre>
<pre>                              - var: analyzed variable name.                                                            </pre>
<pre>                              - fmtname: format name.                                                                   </pre>
<pre>                              - type: type of format (equal to "N" which means "numeric").                                                            </pre>
<pre>                              - start: left end value of each category (length 20).                                                            </pre>
<pre>                              - end: right end value of each category (length 20).                                                            </pre>
<pre>                              - sexcl: flag Y/N indicating whether the start value is included/excluded in each category.                                                            </pre>
<pre>                              - eexcl: flag Y/N indicating whether the end value is included/excluded in each category.                                                            </pre>
<pre>                              - label: label to use for each category (length 200).                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>                              The format name is generated automatically and has the following form:                                                            </pre>
<pre>                              IV_<nnnn>R                                                                                </pre>
<pre>                              where:                                                                                    </pre>
<pre>                              - <nnnn> is a 4-digit identifier of the format which corresponds to the analyzed                                                            </pre>
<pre>                              numeric variable number when they are sorted alphabetically.                                                            </pre>
<pre>                              - R means that the right-end value is included in each category.                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>                              IMPORTANT: It is assumed that the number of digits including decimal point in the                                                            </pre>
<pre>                              start and end values of each category is not larger than 20 when those numbers are                                                            </pre>
<pre>                              expressed in BEST8. format.                                                               </pre>
<pre>                                                                                                                        </pre>
<pre>                              default: (empty)                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>- notes:                      Indicates whether to show SAS notes in the log.                                                            </pre>
<pre>                              The notes are shown only for the PROC MEANS step.                                                            </pre>
<pre>                              Possible values: 0 => No, 1 => Yes.                                                            </pre>
<pre>                              default: 0                                                                                </pre>
<pre>                                                                                                                        </pre>
<pre>- log:                        Show messages in the log?                                                                 </pre>
<pre>                              Possible values: 0 => No, 1 => Yes                                                            </pre>
<pre>                              default: 1                                                                                </pre>
<pre>                                                                                                                        </pre>
<h3>OTHER MACROS AND MODULES USED IN THIS MACRO:</h3>
<pre>- %Callmacro                                                                                                            </pre>
<pre>- %Categorize                                                                                                           </pre>
<pre>- %CreateFormatsFromCuts                                                                                                </pre>
<pre>- %ExecTimeStart                                                                                                        </pre>
<pre>- %ExecTimeStop                                                                                                         </pre>
<pre>- %ExistVar                                                                                                             </pre>
<pre>- %FreqMult                                                                                                             </pre>
<pre>- %Getnobs                                                                                                              </pre>
<pre>- %GetVarList                                                                                                           </pre>
<pre>- %Means                                                                                                                </pre>
<pre>- %RemoveFromList                                                                                                       </pre>
<pre>- %ResetSASOptions                                                                                                      </pre>
<pre>- %SetSASOptions                                                                                                        </pre>
<pre>                                                                                                                        </pre>
<h3>DETAILS:</h3>
<pre>Information Value calculation:                                                                                          </pre>
<pre>Assuming that the possible values taken by the target variable are 0 and 1, and that the event                                                                                          </pre>
<pre>of interest is 1, the expression for the Information Value (IV) is the following:                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>                              IV = Sum{j=1 to J} { [P(j/1) - P(j/0)] * WOE(j)}                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>where:                                                                                                                  </pre>
<pre>- j is the group or bin identifier of the groups of the input categorical variable or the groups                                                                                          </pre>
<pre>into which the input continuous variable is categorized,                                                                                          </pre>
<pre>- J is the number of different values taken by the categorized variable,                                                                                          </pre>
<pre>- P(j/b) is the proportion of cases falling into bin j when the target variable takes the value b,                                                                                          </pre>
<pre>- WOE(j) = ln(P(j/1)/P(j/0)) is the Weight-Of-Evidence of category j w.r.t. to target value 1                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>Note that the WOE can be interpreted as logit(P(1/j)) - logit(P(1)), i.e. the Delta Logit observed                                                                                          </pre>
<pre>in category j w.r.t. the overall population logit.                                                                                          </pre>
<pre>In practice the WOE is adjusted by the number of cases in the category, i.e. the weight is reduced                                                                                          </pre>
<pre>*towards 0* by the value log(J)/ncases(j) i.e.:                                                                                          </pre>
<pre>                              WOE_adj(j)                    = max(0, WOE(j) - log(J)/ncases(j)) if WOE(j) >= 0                              </pre>
<pre>                              = min(0, WOE(j) + log(J)/ncases(j)) if WOE(j) < 0                                                            </pre>
<pre>This adjustment makes it possible for categories with too few cases (for which the information                                                                                          </pre>
<pre>provided about the target variable is unreliable) have a WOE = 0.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>The IV expression can also be interpreted as follows, in terms of the event probability:                                                                                          </pre>
<pre>                              IV = Sum{j=1 to J} { N(j)/N { [P(1/j)/P(1) - P(0/j)/P(0)] * [logit(P(1/j)) - logit(P(1)] }                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>where we observe that every term in the summation is weighted by N(j)/N, i.e. the proportion                                                                                          </pre>
<pre>of observations in category j.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>In order to avoid an undefined value of WOE(j), a smoothing factor is used by default in its                                                                                          </pre>
<pre>computation, which is equal to smooth_factor = 0.5/(#cases in the analyzed variable), making the                                                                                          </pre>
<pre>expression for the smoothed WOE equal to:                                                                                          </pre>
<pre>                              WOE_smoothed(j) = ln( (P(j/1) + smooth_factor) / (P(j/0) + smooth_factor) )                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>The value 0.5 corresponds to a 0.5 adjustment done originally on the COUNTS (which is then                                                                                          </pre>
<pre>translated to a COMMON adjustment on the probabilities by dividing by the number of analyzed cases.                                                                                           </pre>
<pre>                                                                                                                        </pre>
<pre>The use of the smoothing factor can be eliminated by setting parameter SMOOTH=0.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>Notes:                                                                                                                  </pre>
<pre>N1) The IV is ALWAYS non-negative, since a positive/negative difference of probabilities                                                                                          </pre>
<pre>P(j/b) implies a positive/negative value of WOE.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>N2) The WOE is computed based on the value specified in parameter EVENT as the event of interest.                                                                                          </pre>
<pre>If no value is specified or the value does not correspond to any possible target value, the default                                                                                          </pre>
<pre>event is used, i.e. the largest target value (the concept of largest is extended to character target                                                                                          </pre>
<pre>variables based on the alphabetical order).                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>For ex., if the possible target values are 0 and 1 and the EVENT parameter is empty, then the WOE                                                                                          </pre>
<pre>is computed as ln(P(j/1)/P(j/0)). Otherwise, if EVENT=0, the WOE is computed as ln(P(j/0)/P(j/1)).                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>Note that this results in a computation that is contrary to the definition of WOE usually given in the                                                                                          </pre>
<pre>literature, where it is computed as:                                                                                          </pre>
<pre>                              ln(P(j/0)/P(j/1))                                                                         </pre>
<pre>**regardless** of the event of interest.                                                                                          </pre>
<pre>The WOE definition used here favors intuition since a positive WOE in a bin implies an event penetration                                                                                          </pre>
<pre>that is larger than the average event penetration (event rate).                                                                                          </pre>
<pre>                                                                                                                        </pre>
<h3>APPLICATIONS:</h3>
<pre>1.- Have a measure of the information provided by character and numeric variables in the exploratory                                                                                          </pre>
<pre>phase of building a model to predict a dichotomous target variable. This measure does not require that                                                                                          </pre>
<pre>the relationship between the variable and the target variable be linear, as is required by other measures                                                                                          </pre>
<pre>such as the KS or Gini.                                                                                                 </pre>
<pre>However, the following two notes should be taken into account when computing the Information Value:                                                                                          </pre>
<pre>                              - Continuous variables should be analyzed in categories (using the GROUPS= parameter or the FORMAT= parameter).                                                            </pre>
<pre>                              - The Information Value computation does not take into account the size of each categorical value.                                                            </pre>
<pre>                              This means that if a category is too small with respect to the number of observations in the dataset                                                            </pre>
<pre>                              and provides a lot of information about the target variable, this may not be reflected in the                                                            </pre>
<pre>                              Information Value.                                                                        </pre>
<pre>                              However, at the same time, since the category is too small, it may not be good to have a large                                                            </pre>
<pre>                              Information Value for the variable, since that category may not occur so often in the data being                                                            </pre>
<pre>                              modelled.                                                                                 </pre>
<pre>                                                                                                                        </pre>
<pre>2.- This macro could help in identifying variables whose inclusion in a logistic regression may produce                                                                                          </pre>
<pre>quasi-complete separation, which means that the variable is almost a perfect separator of the target                                                                                          </pre>
<pre>variable.                                                                                                               </pre>
<pre>Such variables could be identified by looking at the number of distinct values of the analysis variable                                                                                          </pre>
<pre>that are used in the computation of the Information Value (stored in column NUSED of the OUT= dataset).                                                                                          </pre>
<pre>If this value is too small with respect to the number of distinct values taken by the analysis variable                                                                                          </pre>
<pre>(stored in column NVALUES of the OUT= dataset), it means that for many variable values the target value                                                                                          </pre>
<pre>is only one (as opposed to 2), giving a missing value of the WOE, which means that the information provided                                                                                          </pre>
<pre>by that value is infinite.                                                                                              </pre>
<body>
</html>
