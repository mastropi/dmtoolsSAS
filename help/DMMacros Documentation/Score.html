<!DOCTYPE html>

<html>
<head>
<title>%Score</title>
<style>
pre {display: block}
</style>
<body>
<h1>MACRO %Score</h1>
<pre>Version:                      1.01                                                                                      </pre>
<pre>Author:                       Daniel Mastropietro                                                                       </pre>
<pre>Created:                      19-May-2016                                                                               </pre>
<pre>Modified:                     09-Aug-2016                                                                               </pre>
<pre>                                                                                                                        </pre>
<h3>DESCRIPTION:</h3>
<pre>Score a new dataset based on the estimated parameters of a regression model.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>The model may contain categorical variables with formats which are used to generate                                                                                          </pre>
<pre>the dummy variables needed to score the data, using PROC TRANSREG.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>The input dataset should contain all variables present in the model (except the dummy variables                                                                                          </pre>
<pre>corresponding to any categorical variables present, which are calculated by this macro).                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>Optionally the generated score can be compared to a previously generated one.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<pre>The score is computed using PROC SCORE.                                                                                          </pre>
<pre>                                                                                                                        </pre>
<h3>USAGE:</h3>
<pre>%Score(   data,                         /* Dataset to score containing the variables in the model. */                              </pre>
<pre>          dataparams=_PARAMS_,          /* Dataset with the regression model parameters generated by OUTEST= (single record) */                              </pre>
<pre>          datacatref=,                  /* Dataset with the reference level of the categorical variables in the model. */                              </pre>
<pre>          datacat=,                     /* Dataset with the info about the categorical variables in the model. */                              </pre>
<pre>          ref=first,                    /* Reference level for the categorical variables given in DATACAT. */                              </pre>
<pre>          targetbinary=1,               /* Whether the target is binary (e.g. logistic regression). */                              </pre>
<pre>          id=,                          /* ID variables. */                                         </pre>
<pre>          copy=,                        /* Blank-separated list of variables to copy to the output dataset. */                              </pre>
<pre>          score=,                       /* Name of the score variable that will contain the score computed by PROC SCORE. */                              </pre>
<pre>          response=p,                   /* Name of the response variable associated to the score */                              </pre>
<pre>          /* (e.g. sigmoid transformation of score in logistic model). */                                                            </pre>
<pre>          datacheck=,                   /* Dataset containing a score or response variable to use as comparison. */                              </pre>
<pre>          scorecheck=,                  /* Score variable against which the SCORE variable should be compared */                              </pre>
<pre>          /* (SCORE and SCORECHECK should have different names). */                                                            </pre>
<pre>          responsecheck=,               /* Response variable against which the RESPONSE variable should be compared */                              </pre>
<pre>          /* (RESPONSE and RESPONSECHECK should have different names). */                                                            </pre>
<pre>          varcheck=,                    /* Blank-separated list of additional variables to keep in the OUTCHECK dataset. */                              </pre>
<pre>          outcheck=,                    /* Output dataset used for the comparison, containing only matching observations. */                              </pre>
<pre>          out=,                         /* Output dataset containing the score and response values. */                              </pre>
<pre>          plot=1,                       /* Show plots? */                                           </pre>
<pre>          log=1);                       /* Show messages in the log? */                              </pre>
<pre>                                                                                                    </pre>
<h3>REQUIRED PARAMETERS:</h3>
<pre>- data:                       Input dataset to score. Data options are allowed.                                                            </pre>
<pre>                              It should contain all the regression model variables used during the model fit.                                                            </pre>
<pre>                              Categorical variables should be the original ones.                                                            </pre>
<pre>                              Any formats used for categorical variables as defined in the DATACAT or DATACATREF                                                            </pre>
<pre>                              dataset must exist.                                                                       </pre>
<pre>                                                                                                                        </pre>
<h3>OPTIONAL PARAMETERS:</h3>
<pre>- dataparams:                 Dataset with the regression model parameters.                                                            </pre>
<pre>                              Typically generated by the OUTEST= option of the procedure used to fit the model.                                                            </pre>
<pre>                              It should contain just one record and as many columns as model variables,                                                            </pre>
<pre>                              where categorical variables have been replaced with the corresopnding dummy variables.                                                            </pre>
<pre>                              default: _PARAMS_                                                                         </pre>
<pre>                                                                                                                        </pre>
<pre>- datacatref, datacat:        Datasets containing the categorical variable information with at least the following columns:                                                            </pre>
<pre>                              - var:                        categorical variable name.                                  </pre>
<pre>                              - fmtname:                    format name to use for the categorical variable.                              </pre>
<pre>                              - fmtvalue: format value for the category or the reference level.                                                            </pre>
<pre>                              The DATACATREF dataset should have only one record per variable, containing the reference                                                            </pre>
<pre>                              level used for the variable during the model fit in variable FMTVALUE.                                                            </pre>
<pre>                              When categorical variables exist in the model, at least one of the datasets                                                            </pre>
<pre>                              should be given. When both are given, DATACATREF has preference over DATACAT.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- ref:                        Reference level for the categorical variables. Only used then the DATACAT is given                                                            </pre>
<pre>                              and DATACATREF is empty.                                                                  </pre>
<pre>                              Any value is accepted, but when the value is not First or Last, that same value                                                            </pre>
<pre>                              is used for all categorical variables in the model.                                                            </pre>
<pre>                              default: first                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- targetbinary                Whether the model target variable is binary, as is the case in a logistic regression model.                                                            </pre>
<pre>                              When the target variable is binary, both the SCORE and the RESPONSE variables                                                            </pre>
<pre>                              are computed and stored in the output dataset. Otherwise, only the SCORE variable                                                            </pre>
<pre>                              is computed and stored.                                                                   </pre>
<pre>                              Possible values: 0 => not binary, 1 => binary                                                            </pre>
<pre>                              default: 1                                                                                </pre>
<pre>                                                                                                                        </pre>
<pre>- id:                         When checking the score against DATACHECK, the ID variables should be unique,                                                            </pre>
<pre>                              as a unique index is created on them in order to match the observations with the                                                            </pre>
<pre>                              scored dataset.                                                                           </pre>
<pre>                              When empty, observations are matched by observation number and a warning is shown.                                                            </pre>
<pre>                              These variables are copied to the output dataset.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- copy:                       Blank-separated list of variables to copy to the output dataset.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- score                       Name of the score variable that should contain the score generated by PROC SCORE.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- response                    Name of the response variable associated to the score                                                            </pre>
<pre>                              (e.g. sigmoid transformation of score in logistic model).                                                            </pre>
<pre>                              default: p                                                                                </pre>
<pre>                                                                                                                        </pre>
<pre>- datacheck:                  Dataset containing the SCORECHECK and/or RESPONSECHECK variables                                                            </pre>
<pre>                              against which the score and/or response variables calculated by this macro                                                            </pre>
<pre>                              should be compared.                                                                       </pre>
<pre>                              Cases are matched by the ID variables if given, or by observation number                                                            </pre>
<pre>                              if no ID variables are given, in which case it is assumed that both                                                            </pre>
<pre>                              datasets have the same number of observations.                                                            </pre>
<pre>                              Only matching cases are compared.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- scorecheck                  Score variable in the DATA or DATACHECK dataset against which the SCORE variable should                                                            </pre>
<pre>                              be compared.                                                                              </pre>
<pre>                              It must have a different name than the SCORE variable.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- responsecheck               Response variable in the DATA or DATACHECK dataset against which the RESPONSE variable                                                            </pre>
<pre>                              should be compared.                                                                       </pre>
<pre>                              It must have a different name than the RESPONSE variable.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- varcheck:                   Blank-separated list of variables in the DATACHECK dataset to keep in the                                                            </pre>
<pre>                              OUTCHECK dataset apart from the SCORECHECK and RESPONSECHECK variables.                                                            </pre>
<pre>                              Normally these are model variables that should be analyzed when the check is                                                            </pre>
<pre>                              not satisfactory.                                                                         </pre>
<pre>                              This parameter only makes sense when the DATACHEK dataset is different from the                                                            </pre>
<pre>                              input dataset to score.                                                                   </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- outcheck:                   Output dataset containing all the variables in the DATACHECK dataset but just                                                            </pre>
<pre>                              the records matching the input dataset that are used for the score comparison.                                                            </pre>
<pre>                              This is only created if a DATACHECK dataset is given.                                                            </pre>
<pre>                              The OUTCHECK dataset also contains the score or response variable in the input                                                            </pre>
<pre>                              dataset and the difference between that score or response variable and the                                                            </pre>
<pre>                              scorecheck or responsecheck variable existing in the DATACHECK dataset.                                                            </pre>
<pre>                              The variable containing this difference is called _PRED_DIFF.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- out:                        Output dataset containing the score and/or response variables as well as any                                                            </pre>
<pre>                              specified ID and COPY variables.                                                            </pre>
<pre>                              If no dataset is given, the score is stored in dataset _SCORE_PRED_.                                                            </pre>
<pre>                              default: empty                                                                            </pre>
<pre>                                                                                                                        </pre>
<pre>- plot:                       Show plots on the computed scores and comparison analysis?                                                            </pre>
<pre>                              When yes, a distribution of the score or response variable is shown,                                                            </pre>
<pre>                              and a distribution of the difference between the SCORE and SCORECHECK or                                                            </pre>
<pre>                              the RESPONSE and RESPONSECHECK variable is shown.                                                            </pre>
<pre>                              Possible values: 0 => not binary, 1 => binary                                                            </pre>
<pre>                              default: 1                                                                                </pre>
<pre>                                                                                                                        </pre>
<pre>- log:                        Show messages in the log?                                                                 </pre>
<pre>                              Possible values: 0 => not binary, 1 => binary                                                            </pre>
<pre>                              default: 1                                                                                </pre>
<pre>                                                                                                                        </pre>
<h3>NOTES:</h3>
<pre>1.- The variables in the model that are not used when calculating the score are listed at the end of the process                                                                                          </pre>
<pre>with a WARNING message.                                                                                                 </pre>
<pre>                                                                                                                        </pre>
<h3>OTHER MACROS AND MODULES USED IN THIS MACRO:</h3>
<pre>- %ExecTimeStart                                                                                                        </pre>
<pre>- %ExecTimeStop                                                                                                         </pre>
<pre>- %KeepInList                                                                                                           </pre>
<pre>- %MakeList                                                                                                             </pre>
<pre>- %MakeListFromVar                                                                                                      </pre>
<pre>- %RemoveFromList                                                                                                       </pre>
<pre>- %ResetSASOptions                                                                                                      </pre>
<pre>- %SetSASOptions                                                                                                        </pre>
<pre>                                                                                                                        </pre>
<h3>SEE ALSO:</h3>
<pre>- %FreqMult: to generate the distribution of the categorical variables present in the model that is needed                                                                                          </pre>
<pre>by this macro.                                                                                                          </pre>
<body>
</html>
