<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>SAS Sample 480 : Macro to test multivariate normality</title>
<meta name="creator" content="Samples release 1.2.8 2006/05/23 13:27">

<script language="JavaScript" type="text/javascript" src="/lib/global.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="http://support.sas.com/samples_app/samples.css" type="text/css" />
</head>

<body style="margin:0px;background-color:#ffffff;">
<table style="height:27px;" width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr bgcolor="#000000">
    <td height="27" valign="middle" align="left" nowrap>&nbsp;<b>
      <a href="http://support.sas.com"><font color="#FFFFFF" size="2"><span class="topnav">support.sas.com</span></font></a>
      <font color="#FFFFFF" size="2">&gt;</font>
      <a href="http://support.sas.com/ctx/samples/index.jsp"><font color="#FFFFFF" size="2"><span class="topnav">Samples</span></font></a>
      </b></td>
    <td height="27" valign="middle" align="right" nowrap>        
    <form style="margin:0px;padding:0px;" action="/bin/jump.pl" method="get">  
    <select name="jump_list" onChange="if (options[selectedIndex].value) window.location.href=(options[selectedIndex].value)">
          <option value="http://support.sas.com"> -- Navigate our Site -- </option> 
          <option value="http://support.sas.com/contact/intro.html">Contact Us</option>   
          <option value="http://support.sas.com/rnd/intro.html">Communities</option>         
          <option value="http://support.sas.com/documentation/index.html">Documentation</option>   
          <option value="http://support.sas.com/search/index.html">Search</option>       
          <option value="http://www.sas.com/apps/demosdownloads/setupintro.jsp">Software Downloads</option> 
          <option value="http://support.sas.com/techsup/intro.html">Technical Support</option>        
          <option value="http://support.sas.com/training/">Training</option>  
          <option value="http://www.sas.com/index.html">www.sas.com</option>
</select>
<noscript><input type="submit" value="Go"></noscript>&nbsp;
</form>
 </td>
  </tr>
</table>

<table style="height:50px;" border="0" cellpadding="0" cellspacing="0" width="100%">
  <tr>
    <td width="46%" height="50" bgcolor="#003399"> 
<img src="http://support.sas.com/images/banner/l2_hdd_samples.gif" width="310" height="50" alt="Code Samples"></td>
    <td valign="middle" height="50" align="right" width="54%" bgcolor="#003399"><a href="http://www.sas.com/index.html">
      <img border="0" src="http://support.sas.com/images/global/hdd_rt.gif" width="159" height="50" alt="SAS - The power to know(tm)"></a></td>
  </tr>
</table>

<table width="100%"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td bgcolor="#FFCC33" height="2" colspan="2" nowrap><img src="http://support.sas.com/images/global/clear.gif" width="1" 
height="1" alt=""></td>
</tr>
<tr>
<td bgcolor="#003399" width="99%" height="18" valign="middle" nowrap>&nbsp;
<b>&nbsp;
<a href="http://support.sas.com/ctx/samples/"><font color="#ffffff" size=2><span class="topnav">Samples Home</span></font></a><font color="#FFFFFF" size="2"> |</font>
<a href="http://support.sas.com/documentation/onlinedoc/code.samples.html"><font color="#FFFFFF" size=2><span class="topnav">Samples Published in SAS Documentation</span></font></a><font color="#FFFFFF" size=2> |</font>
<a href="http://support.sas.com/rnd/samples/index.html"><font color="#FFFFFF" size=2><span class="topnav">Samples from SAS Developers</span></font></a>
</b>
</td>
<td bgcolor="#003399" width="5" height="18" valign="bottom" align="right" nowrap><img src="http://support.sas.com/images/global/clear.gif" width="5" height="18" alt=""></td>
</tr>
</table>
<!-- END HEADER -->
<!-- START BODY -->
<div id="body" style="margin:2px 20px 20px 20px;">



<div id="topline" style="text-align:right;margin:2px 10px 1px 0px;">&nbsp;</div>


	
	<!-- START cache Thu Aug 10 17:02:42 EDT 2006 -->

	<table border="0" width="100%" style="margin:0px 10px 15px 0px;padding:0px;"><tr>
<td><span style="font-size:16px;font-color:#000000"><i>Sample 480:</i> <b>Macro to test multivariate normality</b></span></td></tr></table>
<table border=0 cellpadding=0 cellspacing=0><tr><td><a href="index.jsp?sid=480&tab=about"><img src="images/about.gif" border=0></a></td><td><img src="images/details_sel.gif" border=0></td><td><a href="index.jsp?sid=480&tab=output"><img src="images/results.gif" border=0></a></td><td><a href="index.jsp?sid=480&tab=downloads"><img src="images/downloads.gif" border=0></a></td><td><a href="index.jsp?sid=480&tab=rateit"><img src="images/rateit.gif" border=0></a></td><td valign="bottom" height="1" width="100%"><img src="images/black1.gif" height="1" alt="" width="100%"></td></tr></table>
<div id='n2' style="padding:10px 0px 0px 30px;"><h2 align="center">Macro to test multivariate normality</h2>
<table width="90%" align="center">
<tr>
  <td valign="top"><strong>Contents:</strong></td>
  <td>
  <a href="#pur">Purpose</a> / 
  <a href="#hist">History</a> / 
  <a href="#req">Requirements</a> / 
  <a href="#use">Usage</a> / 
  <a href="#det">Details</a> / 
  <a href="#lim">Limitations</a> / 
  <a href="#mis">Missing Values</a> / 
  <a href="#ref">References</a>
  </td></tr>
</table>

<dl>

<dt><strong><em><a name="pur" id="pur"></a>DESCRIPTION:</em></strong></dt>
<dd>
  <p>This macro computes the Information Value (IV) of categorical variables predictors of a <br>
    target dichotomous variable.<br>
    Assuming that the possible values taken by the target variable are 0 and 1, the formula<br>
    for the IV is the following:</p>
  <p> IV = Sum{j=1 to J} { [P(j/1) - P(j/0)]*ln(P(j/1)/P(j/0) }</p>
  <p>or</p>
  <p> IV = Sum{j=1 to J} { [P(j/0) - P(j/1)]*ln(P(j/0)/P(j/1) }</p>
  <p>depending on which of the values (0 or 1) is taken as the reference value (0 is taken<br>
    as the reference value in the first case and 1 in the second case).</p>
  <p>- J is the number of different values taken by the categorical predictor variable,<br>
    - P(j/1) is the probability that the predictor variable take the value j when the<br>
    target variable takes the value 1, and similarly for P(j/0).</p>
  <p>Note that the IV is ALWAYS non-negative, since a positive/negative difference of P(j/.)<br>
    implies a positive/negative value of ln(.).<br>
  </p>
  </dd>

<dt><strong><em><a name="hist" id="hist"></a>USAGE:</em></strong></dt>
<dd>
<table cellpadding="8">
<tr>
<td><em>Version</em><hr></td><td align="center"><em>Update Notes</em><hr></td>
</tr>
<tr>
<td valign="top">1.3</td><td>Added message showing whether MODEL or IML is selected.  Added check for error status after MODEL or IML.  Errors will terminate macro.  Added automatic check for newer version.  Documented difference between tests in PROC MODEL and PROC IML.</td>
</tr>
<tr>
<td valign="top">1.2</td><td>Use SAS/ETS PROC MODEL if available to get all tests, then SAS/IML, then univariate only.  Use ODS SELECT to obtain only normal table from MODEL (requires SAS 7 or later).  Provide univariate histograms with overlaid normal curves and tests controlled by expanded PLOT= parameter.</td>
</tr>
<tr>
<td valign="top">1.1</td><td>Use PVALUE format.  Prefix notes from macro with MULTNORM: instead of NOTE:.</td>
</tr>
<tr>
<td valign="top">1.0</td><td>Initial coding.</td>
</tr>
</table>
<pre></pre></dd>
                                                                      
<dt><strong><em><a name="req" id="req"></a>USAGE:</em></strong></dt>
<dd>
  <p>%InformationValue(</p>
  <blockquote>
    <table border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="208" valign="top"><p>data,</p></td>
        <td width="523" valign="top"><p>/* Input dataset */ </p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>target=,</p></td>
        <td width="523" valign="top"><p>/* Dichotomous target variable */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>var=,</p></td>
        <td width="523" valign="top"><p>/* Analysis variables (character or numeric) */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>event=, </p></td>
        <td width="523" valign="top"><p>/* Event of interest */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>format=, </p></td>
        <td width="523" valign="top"><p>/* Format to use for each analysis variable */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>out=_InformationTable_ </p></td>
        <td width="523" valign="top"><p>/* Table showing the distribution of the target variable    */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>&nbsp;</p></td>
        <td width="523" valign="top"><p>/* for each value of the analysis variables */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>outiv=_InformationValue_, </p></td>
        <td width="523" valign="top"><p>/* Output dataset containing the Information Value for    each variable */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>notes=1, </p></td>
        <td width="523" valign="top"><p>/* Show SAS notes in the log? */</p></td>
      </tr>
      <tr>
        <td width="208" valign="top"><p>log=1); </p></td>
        <td width="523" valign="top"><p>/* Show messages in the log? */</p></td>
      </tr>
    </table>
  </blockquote>
  <pre></pre></dd>

<dt><strong><em><a name="use" id="use"></a>NOTES:</em></strong></dt>
<dd>1.- The WOE (Weight of Evidence) is computed using the value specified in parameter EVENT as the<br />
event of interest. If no value is specified or the value does not correspond to any possible<br />
target value, the default is use: the largest target value (the concept of largest is extended<br />
to character target variables based on the alphabetical order).<br />
For ex., if the possible target values are 0 and 1 and the EVENT parameter is empty, then the WOE<br />
is computed as log(P(j/1)/P(j/0)). Otherwise, if EVENT=0, the WOE is computed as log(P(j/0)/P(j/1)).
</h3>
<dl>
<dt>        <strong>DATA=</strong></dt>
<dd>
                SAS data set to be analyzed.  If the DATA= option is not
                supplied, the most recently created SAS data set is
                used.
<pre></pre></dd>
<dt>        <strong>VAR=</strong></dt>
<dd>
                REQUIRED.  The list of variables to use when testing for
                univariate and multivariate normality.  Individual
                variable names, separated by blanks, must be specified.
                Special variable lists may NOT be used (such as
                VAR1-VAR10, ABC--XYZ, _NUMERIC_).
<pre></pre></dd>
<dt>        <strong>PLOT=BOTH | MULT | UNI | NONE</strong></dt>
<dd>
                PLOT=MULT requests a high- or low-resolution chi-square 
                quantile-quantile (Q-Q) plot of
                the squared Mahalanobis distances of the observations from
                the mean vector.  
                PLOT=UNI requests high-resolution univariate 
                histograms of each variable with overlaid normal curves and 
                additional univariate tests of normality.
                Note that the univariate plots cannot be produced if HIRES=NO. 
                PLOT=BOTH (the default) requests both of the above.  
                PLOT=NONE suppresses all plots and the univariate normality tests.
<pre></pre></dd>
<dt>        <strong>HIRES=YES | NO</strong></dt>
<dd>
                Ignored if PLOT=NONE.  HIRES=YES (the default)
                requests that high-resolution graphics be
                used when creating plots.  You must set the graphics
                device (GOPTIONS DEVICE=) and any other graphics-related
                options before invoking the macro.  HIRES=NO requests
                that the multivariate plot be drawn with low-resolution.  The 
                univariate plots are not available with HIRES=NO.</dd>
</dl>
<pre></pre></dd>
    
<dt><strong><em><a name="det" id="det"></a>DETAILS:</em></strong></dt>
<dd>
     If a set of variables is distributed as multivariate normal, then
     each variable must be normally distributed.  However, when all
     individual variables are normally distributed, the set of variables
     may not be distributed as multivariate normal.  Hence, testing each
     variable only for univariate normality is not sufficient.  Mardia
     (1974) proposed tests of multivariate normality based on sample
     measures of multivariate skewness and kurtosis.

<p>     For multivariate normal data, Mardia (1974) shows that the expected
     value of the multivariate skewness statistic is</p>
<pre>
            p(p+2)[(n+1)(p+1)-6] / (n+1)(n+3)
</pre>
<p>     and the expected value of the multivariate kurtosis statistic is</p>
<pre>
            p(p+2)(n-1)/(n+1)  .
</pre>
<p>  As discussed in the <em>SAS/ETS User's Guide</em>, the Henze-Zirkler test of multivariate normality is based on a nonnegative function that measures the distance between two distribution functions and is used to assess distance between the distribution function of the data and the Multivariate Normal distribution function.</p>
<p>     Univariate normality is tested by either the Shapiro-Wilk W test or
     the Kolmogorov-Smirnov test.  For details on the univariate tests
     of normality, see <strong>Tests for Normality</strong> in &quot;The UNIVARIATE
     Procedure&quot; chapter in the <a href="http://support.sas.com/faq/016/FAQ01652.html"><em>SAS Procedures Guide</em></a>.</p>
<p>     If the p-value of any of the tests is small, then multivariate
     normality can be rejected.  However, it is important to note that
     the univariate Shapiro-Wilk W test is a very powerful test and is
     capable of detecting small departures from univariate normality
     with relatively small sample sizes.  This may cause you to reject
     univariate, and therefore multivariate, normality unnecessarily if
     the tests are being done to validate the use of methods that are
     robust to small departures from normality.</p>
<p>     When the data's covariance matrix is singular, the macro quits and
     the following message is issued:</p>
<pre>
        ERROR: Covariance matrix is singular.
</pre>
<p>     The PRINCOMP procedure in SAS/STAT Software is required for this
     check.  If it is not found, a message is printed, nonsingularity
     is assumed and the macro attempts to perform the tests.</p>
<p>     For p variables and a large sample size, the squared Mahalanobis
     distances of the observations to the mean vector are distributed as
     chi-square with p degrees of freedom.  However, the sample size
     must be quite large for the chi-square distribution to obtain
     unless p is very small.  Also, this plot is sensitive to the
     presence of outliers.  So, this plot should be cautiously used as a
     rough indicator of multivariate normality.</p><pre></pre></dd>

<dt><strong><em><a name="lim" id="lim"></a>LIMITATIONS:</em></strong></dt>
<dd>
     Limited error checking is done.  If the DATA= option is specified,
     be sure the named data set exists.  If DATA= is not specified, a
     data set must have been created previously in the current SAS
     session.  Be sure that the variables specified in the VAR= option
     exist in that data set.  Run PROC CONTENTS on the data set
     prior to using this macro to verify the data set
     name and the names of variables.  

<p>  Memory usage for the multivariate tests is quadratically related to
     the number of observations.  Moderately large data sets (1000 is
     big) may require excessive running time or result in  <strong>Unable to allocate sufficient memory</strong> and macro termination errors.</p>
<p>In some releases after Release 6.12, there may be a small difference in the Shapiro-Wilk test statistics and p-values produced by PROC MODEL and PROC UNIVARIATE as documented in <a href="http://support.sas.com/techsup/unotes/SN/017/017014.html">this SAS Note</a>.  The algorithm in PROC UNIVARIATE was updated in SAS 7 to use the method of Royston (1992) while PROC MODEL continued to use the older method of Royston (1982) which was also used by PROC UNIVARIATE through Release 6.12.  While the PROC MODEL results are correct, the Shapiro-Wilk tests provided by PROC UNIVARIATE are preferred.</p>
<pre></pre></dd>

<dt><strong><em><a name="mis" id="mis"></a>MISSING VALUES:</em></strong></dt>
<dd>
     Observations with missing values are omitted from the analysis and
     plot.
<pre></pre></dd>

<dt><strong><em><a name="ref" id="ref"></a>REFERENCES:</em></strong></dt>
<dd>
     Henze, N. and Zirkler, B. (1990), &quot;A Class of Invariant Consistent 
       tests for Multivariate Normality,&quot; <em>Communications in Statistics, Part A - Theory and Methods.</em>, 19(10), 3595-3617.
<p>     Mardia (1974), &quot;Applications of some measures of multivariate skewness
       and kurtosis in testing normality and robustness studies,&quot; <em>Sankhya B</em>,
       36, 115-128.</p>
<p>     Mardia (1975), &quot;Assessment of Multinormality and the Robustness of
       Hotelling's T-squared Test,&quot; <em>Applied Statistics</em>, 1975, 24(2).</p>
<p>      Mardia, K.V., Kent, J.T., and Bibby, J.M. (1979), &quot;Multivariate Analysis,&quot; New York: Academic Press.</p>
<p>     Mardia (1980), &quot;Measures of Multivariate Skewness and Kurtosis with
       Applications,&quot; <em>Biometrika</em>, 57(3).</p>
<p>     Royston, J.P. (1982), &quot;An Extension of Shapiro and Wilk's W Test
       for Normality to Large Samples,&quot; <em>Applied Statistics</em>, 31.</p>
<p>    Royston, J.P. (1992), &quot;Approximating the Shapiro-Wilk W-Test for Non-normality,&quot; <em>Statistics and Computing</em>, 2, 117 - 119.</p>
<p>     Shapiro, S.S. and Wilk, M.B. (1965), &quot;An Analysis of Variance Test
      for Normality (complete samples),&quot; <em>Biometrika</em>, 52.</p></dd>
</dl>
</div>
	<br /><br /><blockquote><hr><font style="font-size:8pt" face="arial,helvetica,sans-serif" color="#999999">These sample files and code examples are provided by SAS Institute Inc. "as is" without warranty of any kind, either express or implied, including but not limited to the implied warranties of merchantability and fitness for a particular purpose. Recipients acknowledge and agree that SAS Institute shall not be liable for any damages whatsoever arising out of their use of this material. In addition, SAS Institute will provide no support for the materials contained herein.</font></blockquote>
	
	<!-- END CACHE -->

	
	

<!-- BEGIN FOOTER -->
</div>
<center>
<hr>
<img src="http://support.sas.com/images/global/clear.gif" width="13" height="8" alt="">
<span class="yllwbar">
<a href="http://support.sas.com/search/index.html">Search</a> <font size="2">|</font>
<a href="http://support.sas.com/contact/intro.html">Contact Us</a> <font size="2">|</font> 
<a href="http://www.sas.com/Copyright.html">Terms of Use &amp; Legal Information</a>
<font size="2">|</font> <a href="http://www.sas.com/Privacy.html">Privacy Statement</a><br>
Copyright &copy; 2006 SAS Institute Inc. All Rights Reserved.
</span>      
</center>
<br>
<script type="text/javascript" src="/lib/itvsasid.js"></script>
</body>
</html>


	